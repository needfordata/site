<!--allrecords--><div id="allrecords" data-tilda-export="yes" class="t-records" data-hook="blocks-collection-content-node" data-tilda-project-id="14542" data-tilda-page-id="12631093" data-tilda-page-alias="blog/data-privacy-settings-pbi-pq-part-1" data-tilda-formskey="2bb761110255242a2bbb1bf3f837b680" data-tilda-lazy="yes" data-tilda-project-headcode="yes"><!--header--><div id="t-header" class="t-records" data-hook="blocks-collection-content-node" data-tilda-project-id="14542" data-tilda-page-id="61936" data-tilda-page-alias="header" data-tilda-formskey="2bb761110255242a2bbb1bf3f837b680" data-tilda-project-headcode="yes"></div><!--/header--><div id="rec210713990" class="r t-rec" style=" " data-animationappear="off" data-record-type="891" ><!-- cover --><div class="t-cover" id="recorddiv210713990" bgimgfield="img" style="height:450px; background-image:-webkit-linear-gradient(top, #ccc, #777); background-image:-moz-linear-gradient(top, #ccc, #777); background-image:-o-linear-gradient(top, #ccc, #777); background-image:-ms-linear-gradient(top, #ccc, #777); background-image:linear-gradient(top, #ccc, #777); " ><div class="t-cover__carrier" id="coverCarry210713990" data-content-cover-id="210713990" data-content-cover-bg="" data-content-cover-height="450px" data-content-cover-parallax="" style="height:450px;background-attachment:scroll; "></div> <div class="t-cover__filter" style="height:450px;background-image: -moz-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -webkit-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -o-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -ms-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));filter: progid:DXImageTransform.Microsoft.gradient(startColorStr='#000e1f2f', endColorstr='#00182d42');"></div><div class="t891"> <div class="t-container"> <div class="t-col t-col_12"> <div class="t-cover__wrapper t-valign_middle" style="height:450px;"> <div class="t891__wrapper" data-hook-content="covercontent"> <div class="t891__title t-title t-title_xl" style="padding-top:100px;text-shadow: 0px 2px 5px rgba(0, 0, 0, 0.0);" field="title"><div style="font-size:46px;text-align:left;" data-customstyle="yes">Параметры конфиденциальности данных<br /> в Power BI/Power Query, часть 1: <br />Влияние на производительность<br /></div></div> <div class="t891__descr t-descr t-descr_xl " style="" field="descr"><div style="font-size:18px;text-align:left;" data-customstyle="yes">Текст представляет собой адаптированный перевод статьи Chris Webb (Крис Уэбб), <br />оригинал – <a href="https://blog.crossjoin.co.uk/2017/05/24/data-privacy-settings-in-power-bipower-query-part-1-performance-implications/">Data Privacy Settings In Power BI/Power Query, Part 1: Performance Implications</a>.</div></div> <span class="space"></span> </div> </div> </div> </div></div> </div> </div><div id="rec210713991" class="r t-rec t-rec_pt_90 t-rec_pb_15" style="padding-top:90px;padding-bottom:15px; " data-record-type="296" ><!-- t265 --><div class="t265"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t265__wrapper" style="background:#fafafa;"> <div class="t265__icon"> <svg x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;"> <circle style="fill:#edbd11;" cx="12.125" cy="12.125" r="12"/> <g> <path style="fill:#ffffff;" d="M10.922,6.486c0-0.728,0.406-1.091,1.217-1.091s1.215,0.363,1.215,1.091c0,0.347-0.102,0.617-0.304,0.81 c-0.202,0.193-0.507,0.289-0.911,0.289C11.328,7.585,10.922,7.219,10.922,6.486z M13.252,17.792h-2.234V9.604h2.234V17.792z"/> </g> </svg> </div> <div class="t265__text t-descr t-descr_xs" style="color:#000000;" field="text"><div style="font-size:14px;" data-customstyle="yes"><a href="https://blog.crossjoin.co.uk/" style="color:rgb(0, 0, 0) !important;">Крис Вебб</a> (Chris Webb) — независимый эксперт, консультант по технологиям Analysis Services, MDX, Power Pivot, DAX, Power Query и Power BI. Его блог — это кладезь информации на тему перечисленных технологий. Вот уже более 10 лет он пишет про BI-решения от Microsoft. Количество его статей перевалило за 1000! Также Крис выступает на большом количестве различных конференций вроде SQLBits, PASS Summit, PASS BA Conference, SQL Saturdays и участвует в различных сообществах.<br />Крис любезно разрешил нам переводить его статьи на русский язык. И это одна из них.</div></div> </div> </div> </div></div></div><div id="rec210713993" class="r t-rec t-rec_pt_15 t-rec_pb_0" style="padding-top:15px;padding-bottom:0px; " data-record-type="128" ><!-- T120 --><div class="t120"> <div class="t-container t-align_left"> <div class="t-col t-col_8 t-prefix_2"> <h3 class="t120__title t-heading t-heading_sm" field="title" style="font-size:16px;">Параметры конфиденциальности данных в Power BI/Power Query, часть 1: влияние на производительность<br /></h3> </div> </div></div></div><div id="rec210713994" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Одной из наиболее запутанных, недостаточно документированных и плохо понимаемых функций Power BI и Power Query (оно же Get &amp; Transform) являются параметры конфиденциальности данных. Автор неоднократно спотыкался на этом, поэтому было решено написать серию статей, демонстрирующих, как это работает и какой эффект производит в различных сценариях на примере запросов языка М. <br /><br /> Прежде чем продолжить, мы настоятельно рекомендуем ознакомиться с <a href="https://powerbi.microsoft.com/en-us/documentation/powerbi-desktop-privacy-levels/">официальной документацией Майкрософт по этому вопросу</a>. <br /><br /> Это даст хорошее понимание о разных уровнях конфиденциальности и где они настраиваются в Power BI UI. Эти же параметры доступны в Excel в зависимости от версии на вкладке Power Query или Get &amp; Transform. <br /><br /> В первой части мы рассмотрим, какое влияние на производительность могут оказать разные уровни конфиденциальности. Допустим, у нас есть два источника данных. Первый – книга Excel с одной таблицей, содержащей название дня недели:<br /></div></div></div></div></div></div><div id="rec210713997" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3166-6262-4666-b030-613735383163__-__empty__image1.png" data-original="images/tild3166-6262-4666-b030-613735383163__image1.png" imgfield="img" /><meta itemprop="image" content="images/tild3166-6262-4666-b030-613735383163__image1.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210713996" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Второй – таблица DimDate в базе данных Adventure Works DW на SQL сервере:</div></div></div></div></div></div><div id="rec210714453" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3931-3362-4837-b961-323733643837__-__empty__image2.png" data-original="images/tild3931-3362-4837-b961-323733643837__image2.png" imgfield="img" /><meta itemprop="image" content="images/tild3931-3362-4837-b961-323733643837__image2.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210713998" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Вот код запроса FilterDay, возвращающего название дня недели из таблицы книги Excel:</div></div></div></div></div></div><div id="rec210713999" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-animationappear="off" data-record-type="285" ><!-- t264 --><div class="t264"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t264__wrapper t-text t-text_xs" style="border: 0px solid #f8f8f8;"><pre><code class="auto">let
      Source = Excel.Workbook(
            File.Contents(&quot;C:\Filter.xlsx&quot;)
            , null, true),
      FilterDay_Table = Source{[Item=&quot;FilterDay&quot;,Kind=&quot;Table&quot;]}[Data],
      ChangedType =
      Table.TransformColumnTypes(
            FilterDay_Table,
            {{&quot;Parameter&quot;, type text}}),
      Output = ChangedType{0}[#&quot;Parameter&quot;]
in
      Output</code></pre> </div> </div> </div></div> <script type="text/javascript"> $(document).ready(function(){	hljs.initHighlightingOnLoad(); }); </script> <style type="text/css"> .t264 .hljs { background-color: ; }</style> </div><div id="rec210714000" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild6432-3737-4633-a534-636539306330__-__empty__image3.png" data-original="images/tild6432-3737-4633-a534-636539306330__image3.png" imgfield="img" /><meta itemprop="image" content="images/tild6432-3737-4633-a534-636539306330__image3.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210714001" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Это код запроса DimDate, возвращающего отфильтрованные данные из таблицы DimDate базы данных Adventure Works DW. Возвращаются только те строки, где ячейки в колонке EnglishDayNameOfWeek равны значению, полученному запросом FilterDay из примера выше.</div></div></div></div></div></div><div id="rec210714002" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-animationappear="off" data-record-type="285" ><!-- t264 --><div class="t264"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t264__wrapper t-text t-text_xs" style="border: 0px solid #f8f8f8;"><pre><code class="auto">Let
      Source = Sql.Databases(&quot;localhost&quot;),
      DB = Source{[Name=&quot;Adventure Works DW&quot;]}[Data],
      dbo_DimDate = DB{[Schema=&quot;dbo&quot;,Item=&quot;DimDate&quot;]}[Data],
      RemovedColumns = Table.SelectColumns(dbo_DimDate,
            {&quot;DateKey&quot;, &quot;EnglishDayNameOfWeek&quot;}),
      FilteredRows = Table.SelectRows(RemovedColumns,
            each ([EnglishDayNameOfWeek] = FilterDay))
in
      FilteredRows</code></pre> </div> </div> </div></div> <script type="text/javascript"> $(document).ready(function(){	hljs.initHighlightingOnLoad(); }); </script> <style type="text/css"> .t264 .hljs { background-color: ; }</style> </div><div id="rec210714004" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">При первом запуске второго запроса будут запрошены учётные данные для подключения к серверу SQL и затем (если не были выбраны параметры игнорирования уровня конфиденциальности) будет сообщение о необходимости соответствующей информации:</div></div></div></div></div></div><div id="rec210714003" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3364-6466-4661-a231-663532656133__-__empty__image4.png" data-original="images/tild3364-6466-4661-a231-663532656133__image4.png" imgfield="img" /><meta itemprop="image" content="images/tild3364-6466-4661-a231-663532656133__image4.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210714006" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Нажимаем Continue и устанавливаем уровень конфиденциальности для сервера SQL и корневого диска, на котором находится книга Excel:</div></div></div></div></div></div><div id="rec210714008" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild6432-3861-4134-a238-646237356535__-__empty__image5.png" data-original="images/tild6432-3861-4134-a238-646237356535__image5.png" imgfield="img" /><meta itemprop="image" content="images/tild6432-3861-4134-a238-646237356535__image5.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210714009" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Выпадающие списки слева позволяют точнее определить, на что устанавливаются уровни конфиденциальности. В случае файла Excel, права доступа могут быть назначены на все папки по пути к книге и на саму книгу. В случае сервера SQL, уровень конфиденциальности можно назначить на базу данных, а не на сервер. <br /><br /> Назначьте любой из трех уровней (Public, Organizational или Private) для сервера SQL и файла Excel. Запрос будет работать:<br /></div></div></div></div></div></div><div id="rec210714011" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3461-6266-4339-b562-623139313036__-__empty__image6.png" data-original="images/tild3461-6266-4339-b562-623139313036__image6.png" imgfield="img" /><meta itemprop="image" content="images/tild3461-6266-4339-b562-623139313036__image6.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210714012" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Вот здесь все становится запутанным. На данный момент у книги уровень конфиденциальности None, который ставится по умолчанию для вновь созданных источников:</div></div></div></div></div></div><div id="rec210714015" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild6664-3336-4530-b239-373030386236__-__empty__image7.png" data-original="images/tild6664-3336-4530-b239-373030386236__image7.png" imgfield="img" /><meta itemprop="image" content="images/tild6664-3336-4530-b239-373030386236__image7.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210714016" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Однако этот параметр None означает, что он унаследован от параметра c:\ drive, установленного ранее, хотя это и не отражается на вкладке Data sources in current file. Будем надеяться, что на этот вопрос рассмотрят в следующем релизе. Текущий интерфейс несколько вводит в заблуждение. <br /><br /> В нашем случае параметры конфиденциальности данных сервера SQL не имеют значения, в отличие от книги Excel. Для определённости установите для сервера SQL уровень Private, а для книги Excel Public:<br /></div></div></div></div></div></div><div id="rec210714018" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3134-6137-4239-b439-313237366537__-__empty__image8.png" data-original="images/tild3134-6137-4239-b439-313237366537__image8.png" imgfield="img" /><meta itemprop="image" content="images/tild3134-6137-4239-b439-313237366537__image8.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210714019" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Если щелкнуть по шагу FilteredRows в запросе, возвращающем таблицу DimDate с сервера SQL, и выбрать пункт View Native Query, то получим текст самого запроса SQL:</div></div></div></div></div></div><div id="rec210714021" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3437-6633-4130-b063-636233383433__-__empty__image9.png" data-original="images/tild3437-6633-4130-b063-636233383433__image9.png" imgfield="img" /><meta itemprop="image" content="images/tild3437-6633-4130-b063-636233383433__image9.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210714022" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Из кода видно, что происходит «Query Folding» запроса и добавляется фильтр по столбцу EnglishDayNameOfWeek:</div></div></div></div></div></div><div id="rec210714024" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild6637-3135-4565-b635-366136356135__-__empty__image10.png" data-original="images/tild6637-3135-4565-b635-366136356135__image10.png" imgfield="img" /><meta itemprop="image" content="images/tild6637-3135-4565-b635-366136356135__image10.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210714026" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-animationappear="off" data-record-type="285" ><!-- t264 --><div class="t264"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t264__wrapper t-text t-text_xs" style="border: 0px solid #f8f8f8;"><pre><code class="auto">select [_].[DateKey],
      [_].[EnglishDayNameOfWeek]
from
(
      select [DateKey],
            [EnglishDayNameOfWeek]
      from [dbo].[DimDate] as [$Table]
) as [_]
where [_].[EnglishDayNameOfWeek] = &#039;Friday&#039;</code></pre> </div> </div> </div></div> <script type="text/javascript"> $(document).ready(function(){	hljs.initHighlightingOnLoad(); }); </script> <style type="text/css"> .t264 .hljs { background-color: ; }</style> </div><div id="rec210715333" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes"> Query Folding запроса почти всегда повышает его эффективность. <br /><br /> Теперь изменим уровень конфиденциальности следующим образом:<br /></div></div></div></div></div></div><div id="rec210715443" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3262-6330-4162-a436-323363633735__-__empty__image11.png" data-original="images/tild3262-6330-4162-a436-323363633735__image11.png" imgfield="img" /><meta itemprop="image" content="images/tild3262-6330-4162-a436-323363633735__image11.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210715500" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">…несмотря на то, что запрос DimDate остаётся рабочим, Query Folding запроса для шага Filtered Rows не происходит. При щелчке ПКМ пункт View Native Query неактивен, а Profiler выдаёт следующий код SQL при обновлении запроса:</div></div></div></div></div></div><div id="rec210715609" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-animationappear="off" data-record-type="285" ><!-- t264 --><div class="t264"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t264__wrapper t-text t-text_xs" style="border: 0px solid #f8f8f8;"><pre><code class="auto">select [$Ordered].[DateKey],
      [$Ordered].[EnglishDayNameOfWeek]
from
(
      select [DateKey],
            [EnglishDayNameOfWeek]
      from [dbo].[DimDate] as [$Table]
) as [$Ordered]
order by [$Ordered].[DateKey]</code></pre> </div> </div> </div></div> <script type="text/javascript"> $(document).ready(function(){	hljs.initHighlightingOnLoad(); }); </script> <style type="text/css"> .t264 .hljs { background-color: ; }</style> </div><div id="rec210715672" class="r t-rec t-rec_pt_0 t-rec_pb_15" style="padding-top:0px;padding-bottom:15px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Обратите внимание, в этом запросе нет условия WHERE и сервер SQL возвращает всю таблицу DimDate. <br /><br /> Данные от источника данных с уровнем конфиденциальности Private никогда не пересылаются другому источнику. А это как раз необходимо, чтобы произошел Query Folding запроса. Например, значение из книги Excel – текст Friday – должно быть вставлено в условие WHERE запроса SQL для отсылки на сервер, чтобы фильтрация произошла внутри базы данных. Риск использования Query Folding запросов заключён в том, что администратор базы данных может отслеживать запросы, приходящие на сервер. Просмотр условия WHERE позволит увидеть данные книги Excel. Это не представляет проблемы для названия дня недели, но может стать такой в случае конфиденциальных данных таких как имена и адреса клиентов. Поэтому при уровне книги Private для обеспечения конфиденциальности происходит скачивание всей таблицы DimDate и дальнейшая фильтрация данных идёт внутри Excel. Запрос остаётся работоспособным, но выполняется дольше чем при складывании запроса. Если же уровень конфиденциальности книги Excel установлен Public, то данные могут быть отосланы на сервер и происходит Query Folding запроса. <br /><br /> <em>Подведём итог.</em> В этой статье рассмотрено, как разные уровни конфиденциальности влияют на производительность запроса, определяя, происходит ли Query Folding запроса. Во второй части мы рассмотрим, как различные параметры конфиденциальности определяют, выполнится ли запрос вообще.<br /></div></div></div></div></div></div><div id="rec230236624" class="r t-rec t-rec_pt_0 t-rec_pb_15" style="padding-top:0px;padding-bottom:15px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Это статья входит в цикл статей посвященных работе formula firewall:<br />- <a href="https://needfordata.ru/blog/data-privacy-settings-pbi-pq-part-1">часть 1</a> <br />- <a href="https://needfordata.ru/blog/data-privacy-settings-pbi-pq-part-2">часть 2</a> <br />- <a href="https://needfordata.ru/blog/data-privacy-settings-pbi-pq-part-3">часть 3</a> <br />- <a href="https://needfordata.ru/blog/data-privacy-settings-pbi-pq-part-4">часть 4</a> <br />- <a href="https://needfordata.ru/blog/data-privacy-settings-pbi-pq-part-5">часть 5</a> <br /><br /></div></div></div></div></div></div></div><!--/allrecords-->