<!--allrecords--><div id="allrecords" data-tilda-export="yes" class="t-records" data-hook="blocks-collection-content-node" data-tilda-project-id="14542" data-tilda-page-id="12623934" data-tilda-page-alias="blog/parametr-allow-data-preview-to-download-in-the-background-v-power-query" data-tilda-formskey="2bb761110255242a2bbb1bf3f837b680" data-tilda-lazy="yes" data-tilda-project-headcode="yes"><!--header--><div id="t-header" class="t-records" data-hook="blocks-collection-content-node" data-tilda-project-id="14542" data-tilda-page-id="61936" data-tilda-page-alias="header" data-tilda-formskey="2bb761110255242a2bbb1bf3f837b680" data-tilda-project-headcode="yes"></div><!--/header--><div id="rec210607703" class="r t-rec" style=" " data-animationappear="off" data-record-type="891" ><!-- cover --><div class="t-cover" id="recorddiv210607703" bgimgfield="img" style="height:450px; background-image:-webkit-linear-gradient(top, #ccc, #777); background-image:-moz-linear-gradient(top, #ccc, #777); background-image:-o-linear-gradient(top, #ccc, #777); background-image:-ms-linear-gradient(top, #ccc, #777); background-image:linear-gradient(top, #ccc, #777); " ><div class="t-cover__carrier" id="coverCarry210607703" data-content-cover-id="210607703" data-content-cover-bg="" data-content-cover-height="450px" data-content-cover-parallax="" style="height:450px;background-attachment:scroll; "></div> <div class="t-cover__filter" style="height:450px;background-image: -moz-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -webkit-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -o-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -ms-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));filter: progid:DXImageTransform.Microsoft.gradient(startColorStr='#000e1f2f', endColorstr='#00182d42');"></div><div class="t891"> <div class="t-container"> <div class="t-col t-col_12"> <div class="t-cover__wrapper t-valign_middle" style="height:450px;"> <div class="t891__wrapper" data-hook-content="covercontent"> <div class="t891__title t-title t-title_xl" style="padding-top:100px;text-shadow: 0px 2px 5px rgba(0, 0, 0, 0.0);" field="title"><div style="font-size:46px;text-align:left;" data-customstyle="yes">Параметр Allow Data Preview To Download In The Background в Power Query и Power BI<br /></div></div> <div class="t891__descr t-descr t-descr_xl " style="" field="descr"><div style="font-size:18px;text-align:left;" data-customstyle="yes">Текст представляет собой адаптированный перевод статьи Chris Webb (Крис Уэбб), <br />оригинал — <a href="https://blog.crossjoin.co.uk/2016/12/05/power-query-power-bi-and-the-allow-data-preview-to-download-in-the-background-option/">Power Query, Power BI And The "Allow Data Preview To Download In The Background" Option</a>.</div></div> <span class="space"></span> </div> </div> </div> </div></div> </div> </div><div id="rec210607704" class="r t-rec t-rec_pt_90 t-rec_pb_15" style="padding-top:90px;padding-bottom:15px; " data-record-type="296" ><!-- t265 --><div class="t265"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t265__wrapper" style="background:#fafafa;"> <div class="t265__icon"> <svg x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;"> <circle style="fill:#edbd11;" cx="12.125" cy="12.125" r="12"/> <g> <path style="fill:#ffffff;" d="M10.922,6.486c0-0.728,0.406-1.091,1.217-1.091s1.215,0.363,1.215,1.091c0,0.347-0.102,0.617-0.304,0.81 c-0.202,0.193-0.507,0.289-0.911,0.289C11.328,7.585,10.922,7.219,10.922,6.486z M13.252,17.792h-2.234V9.604h2.234V17.792z"/> </g> </svg> </div> <div class="t265__text t-descr t-descr_xs" style="color:#000000;" field="text"><div style="font-size:14px;" data-customstyle="yes"><a href="https://blog.crossjoin.co.uk/" style="color:rgb(0, 0, 0) !important;">Крис Вебб</a> (Chris Webb) — независимый эксперт, консультант по технологиям Analysis Services, MDX, Power Pivot, DAX, Power Query и Power BI. Его блог — это кладезь информации на тему перечисленных технологий. Вот уже более 10 лет он пишет про BI-решения от Microsoft. Количество его статей перевалило за 1000! Также Крис выступает на большом количестве различных конференций вроде SQLBits, PASS Summit, PASS BA Conference, SQL Saturdays и участвует в различных сообществах.<br />Крис любезно разрешил нам переводить его статьи на русский язык. И это одна из них.</div></div> </div> </div> </div></div></div><div id="rec210607706" class="r t-rec t-rec_pt_15 t-rec_pb_0" style="padding-top:15px;padding-bottom:0px; " data-record-type="128" ><!-- T120 --><div class="t120"> <div class="t-container t-align_left"> <div class="t-col t-col_8 t-prefix_2"> <h3 class="t120__title t-heading t-heading_sm" field="title" style="font-size:16px;">Параметр Allow Data Preview To Download In The Background в Power Query и Power BI<br /></h3> </div> </div></div></div><div id="rec210607707" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Недавно мы настраивали книгу Excel с большим количеством запросов в ней. Хотя все данные получались из таблиц книги, их объём был небольшим, но общее количество запросов равнялось пятидесяти. При обновлении всех запросов возникала длительная пиковая нагрузка на центральный процессор и занимался большой объём памяти.<br />Только небольшое количество из пятидесяти запросов загружались в книгу, и ни один в модель данных. Запросы ссылались на другие по цепочке, длиной до десятка запросов. Общая картинка по зависимостям вопросов выглядела примерно так:</div></div></div></div></div></div><div id="rec210607710" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3937-3233-4365-a432-353134366465__-__empty__image1.png" data-original="images/tild3937-3233-4365-a432-353134366465__image1.png" imgfield="img" /><meta itemprop="image" content="images/tild3937-3233-4365-a432-353134366465__image1.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210607711" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Мы придерживаемся такого подхода, когда для разделения сложной логики, применяются ссылки на отдельные запросы. В нашем случае это абсолютно оправдано, иначе работать с книгой было бы невозможно. Из чего совершенно ясно, что проблема возникала при обновлении. <br /><br /> В дальнейшем мы поняли, что если обновлять отдельные запросы, которые действительно загружают данные, никаких трудностей, возникающих при использовании кнопки <em>Refresh All</em>, не было. Значит источником проблемы являлись запросы, которые не загружали данные в книгу. <br /><br /> И Power Query и Power BI загружают предварительный просмотр данных в окошко Query Editor. При щелчке по <em>Refresh All</em> произойдёт загрузка предварительного просмотра для всех запросов. А это займёт все ресурсы центрального процессора и памяти. Чтобы избежать этого, нужно убрать галку с параметра настроек <em>Allow Data Preview To Download In The Background</em>, появившийся в версиях Power BI в январе 2016, и Power Query/Get &amp; Transform в Excel. <br /><br /> В экселе этот параметр доступен в диалоге <em>Query Options</em>:<br /></div></div></div></div></div></div><div id="rec210607713" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild6532-6164-4439-a432-323137653965__-__empty__image2.png" data-original="images/tild6532-6164-4439-a432-323137653965__image2.png" imgfield="img" /><meta itemprop="image" content="images/tild6532-6164-4439-a432-323137653965__image2.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210607714" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">…выберем пункт <em>Current Workbook/Data Load</em>. И снимем флажок с пункта <em>Allow data preview to download in the background</em>:</div></div></div></div></div></div><div id="rec210607716" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3131-6563-4661-b366-666535326437__-__empty__image3.png" data-original="images/tild3131-6563-4661-b366-666535326437__image3.png" imgfield="img" /><meta itemprop="image" content="images/tild3131-6563-4661-b366-666535326437__image3.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210607727" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Вот пример того, что возвращает данный запрос из книги, содержащей несколько запросов:</div></div></div></div></div></div><div id="rec210607728" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3438-3235-4238-b833-386537633333__-__empty__p6.png" data-original="images/tild3438-3235-4238-b833-386537633333__p6.png" imgfield="img" /><meta itemprop="image" content="images/tild3438-3235-4238-b833-386537633333__p6.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210607729" class="r t-rec t-rec_pt_0 t-rec_pb_120" style="padding-top:0px;padding-bottom:120px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">…фоновая загрузка предварительного просмотра при обновлении запроса остановится. <br /><br /> После этого, с небольшой подстройкой, использовали функцию <em>Table.Buffer()</em>. Все проблемы с <em>Refresh All</em> ушли, обновление прошло очень быстро.<br />Данный трюк применим для книг Excel и файлов pbix.<br /></div></div></div></div></div></div></div><!--/allrecords-->