<!--allrecords--><div id="allrecords" data-tilda-export="yes" class="t-records" data-hook="blocks-collection-content-node" data-tilda-project-id="14542" data-tilda-page-id="12580051" data-tilda-page-alias="blog/rabota-s-mezhdunarodnoj-datoj-i-chislovymi-formatami-v-power-query" data-tilda-formskey="2bb761110255242a2bbb1bf3f837b680" data-tilda-lazy="yes" data-tilda-project-headcode="yes"><!--header--><div id="t-header" class="t-records" data-hook="blocks-collection-content-node" data-tilda-project-id="14542" data-tilda-page-id="61936" data-tilda-page-alias="header" data-tilda-formskey="2bb761110255242a2bbb1bf3f837b680" data-tilda-project-headcode="yes"></div><!--/header--><div id="rec209930616" class="r t-rec" style=" " data-animationappear="off" data-record-type="891" ><!-- cover --><div class="t-cover" id="recorddiv209930616" bgimgfield="img" style="height:450px; background-image:-webkit-linear-gradient(top, #ccc, #777); background-image:-moz-linear-gradient(top, #ccc, #777); background-image:-o-linear-gradient(top, #ccc, #777); background-image:-ms-linear-gradient(top, #ccc, #777); background-image:linear-gradient(top, #ccc, #777); " ><div class="t-cover__carrier" id="coverCarry209930616" data-content-cover-id="209930616" data-content-cover-bg="" data-content-cover-height="450px" data-content-cover-parallax="" style="height:450px;background-attachment:scroll; "></div> <div class="t-cover__filter" style="height:450px;background-image: -moz-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -webkit-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -o-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -ms-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));filter: progid:DXImageTransform.Microsoft.gradient(startColorStr='#000e1f2f', endColorstr='#00182d42');"></div><div class="t891"> <div class="t-container"> <div class="t-col t-col_12"> <div class="t-cover__wrapper t-valign_middle" style="height:450px;"> <div class="t891__wrapper" data-hook-content="covercontent"> <div class="t891__title t-title t-title_xl" style="padding-top:100px;text-shadow: 0px 2px 5px rgba(0, 0, 0, 0.0);" field="title"><div style="font-size:46px;text-align:left;" data-customstyle="yes">Работа с международной датой<br /> и числовыми форматами в Power Query<br /></div></div> <div class="t891__descr t-descr t-descr_xl " style="" field="descr"><div style="font-size:18px;text-align:left;" data-customstyle="yes">Адаптированный перевод текста <a href="https://blog.crossjoin.co.uk/2015/05/25/working-with-international-date-and-number-formats-in-power-query/">Working With International Date And Number Formats In Power Query</a>,<br /> автор Chris Webb (Крис Вебб). В статье речь идет о надстройке Power Query.<em></em><br /></div></div> <span class="space"></span> </div> </div> </div> </div></div> </div> </div><div id="rec209930617" class="r t-rec t-rec_pt_90 t-rec_pb_15" style="padding-top:90px;padding-bottom:15px; " data-record-type="296" ><!-- t265 --><div class="t265"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t265__wrapper" style="background:#fafafa;"> <div class="t265__icon"> <svg x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;"> <circle style="fill:#edbd11;" cx="12.125" cy="12.125" r="12"/> <g> <path style="fill:#ffffff;" d="M10.922,6.486c0-0.728,0.406-1.091,1.217-1.091s1.215,0.363,1.215,1.091c0,0.347-0.102,0.617-0.304,0.81 c-0.202,0.193-0.507,0.289-0.911,0.289C11.328,7.585,10.922,7.219,10.922,6.486z M13.252,17.792h-2.234V9.604h2.234V17.792z"/> </g> </svg> </div> <div class="t265__text t-descr t-descr_xs" style="color:#000000;" field="text"><div style="font-size:14px;" data-customstyle="yes"><a href="https://blog.crossjoin.co.uk/" style="color:rgb(0, 0, 0) !important;">Крис Вебб</a> (Chris Webb) — независимый эксперт, консультант по технологиям Analysis Services, MDX, Power Pivot, DAX, Power Query и Power BI. Его блог — это кладезь информации на тему перечисленных технологий. Вот уже более 10 лет он пишет про BI-решения от Microsoft. Количество его статей перевалило за 1000! Также Крис выступает на большом количестве различных конференций вроде SQLBits, PASS Summit, PASS BA Conference, SQL Saturdays и участвует в различных сообществах.<br />Крис любезно разрешил нам переводить его статьи на русский язык. И это одна из них.</div></div> </div> </div> </div></div></div><div id="rec209930619" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Одна из проблем, которая действительно может довести до безумия при работе с данными текстовых файлов – это множество форматов дат и чисел, применяемых в них. <br /><br /> Например, взглянем на скриншот, где отражено содержимое файла с разделителем – знаком табуляции:<br /></div></div></div></div></div></div><div id="rec209930622" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3036-3438-4561-a564-393434386362__-__empty__image-1.jpg" data-original="images/tild3036-3438-4561-a564-393434386362__image-1.jpg" imgfield="img" /><meta itemprop="image" content="images/tild3036-3438-4561-a564-393434386362__image-1.jpg"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec209930623" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Здесь одна строка и две колонки: Date and Sales. Что же они означают? <br /><br /> Житель Великобритании прочтет дату как 2-е марта 2015 (в Англии, как и в большей части мира используют формат DD/MM/YYYY – день/месяц/год), а число прочтет как сто тысяч два (в Англии используют точку для отделения дробной части, и запятую для отделения тысяч). Однако для американца дата выглядит как 3-е февраля 2015. А француз прочитает число как сто целых две тысячных. Так что, если вы работаете в одной стране, а получаете данные из другой, то необходимо учитывать эти нюансы. <br /><br /> К счастью, Power Query легко это сделает, даже если механизм не вполне понятен. Вам не придется менять язык Windows, или разбивать даты на составные части и собирать их в правильном порядке, или делать нечто подобное. <br /><br /> При первой загрузке csv файла, подобного показанному выше, Power Query попытается определить тип данных для каждого столбца. Ниже приведён код, сгенерированный Power Query для этого файла:<br /></div></div></div></div></div></div><div id="rec209930630" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-animationappear="off" data-record-type="285" ><!-- t264 --><div class="t264"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t264__wrapper t-text t-text_xs" style="border: 0px solid #f8f8f8;"><pre><code class="auto">let   
Источник = Csv.Document(File.Contents(  
&quot;D:\Temp\Перевод\Working With International Date And Number Formats In Power Query\TESTFILE.csv&quot;),  
[Delimiter=&quot; &quot;, Columns=2, Encoding=1251, QuoteStyle=QuoteStyle.None]),
&quot;Повышенные заголовки&quot; = Table.PromoteHeaders(Источник),
&quot;Измененный тип&quot; = Table.TransformColumnTypes(  
#&quot;Повышенные заголовки&quot;,{{&quot;Date&quot;, type date}, {&quot;Sales&quot;, type number}})  
in  
# &quot;Измененный тип&quot; </code></pre> </div> </div> </div></div> <script type="text/javascript"> $(document).ready(function(){	hljs.initHighlightingOnLoad(); }); </script> <style type="text/css"> .t264 .hljs { background-color: ; }</style> </div><div id="rec209932809" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Как мы видим, автоматически создано три шага: <br /><br /> <ol> <li> <strong>Источник</strong> – загружает данные из CSV файла и определяет разделитель табуляция. <br /><br /> </li> <li> <strong># "Повышенные заголовки"</strong> – использовать первую строку данных для заголовков столбцов. <br /><br /> </li> <li> <strong># "Измененный тип"</strong> – устанавливает для столбца Date тип данных дата, а для столбца Sales числовой.<br /> </li></ol></div></div></div></div></div></div><div id="rec209930624" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3663-6637-4562-b166-383566316665__-__empty__image-2.jpg" data-original="images/tild3663-6637-4562-b166-383566316665__image-2.jpg" imgfield="img" /><meta itemprop="image" content="images/tild3663-6637-4562-b166-383566316665__image-2.jpg"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec209930625" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">В русском варианте <em>Первая строка как заголовки</em> стала <em>Повышенные заголовки</em> (прим. пер.) <br /><br /> Для изменения типа данных столбца, нужно сначала удалить шаг <em>Изменённый тип</em>, щелкнув по крестику слева от пункта меню. После этого щелкаем ПКМ на заголовке столбца Date, выбираем <em>Тип изменения</em>, потом <em>Используя локаль…</em><br /></div></div></div></div></div></div><div id="rec209930626" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3232-6534-4635-b266-323934626632__-__empty__image-3.jpg" data-original="images/tild3232-6534-4635-b266-323934626632__image-3.jpg" imgfield="img" /><meta itemprop="image" content="images/tild3232-6534-4635-b266-323934626632__image-3.jpg"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec209930627" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Появится диалоговое окно Изменение типа локали:</div></div></div></div></div></div><div id="rec209933554" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3730-6630-4334-b736-633639353231__-__empty__p4-1.jpg" data-original="images/tild3730-6630-4334-b736-633639353231__p4-1.jpg" imgfield="img" /><meta itemprop="image" content="images/tild3730-6630-4334-b736-633639353231__p4-1.jpg"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec209933626" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Локаль – это просто название для всех правил форматов дат и чисел и многого другого, связанного с определённым языком и регионом. Так, например, выбрав Языковой стандарт русский для столбца Date, увидим 03.02.2015.</div></div></div></div></div></div><div id="rec209933818" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3538-6431-4262-b839-333262653533__-__empty__p5-1.jpg" data-original="images/tild3538-6431-4262-b839-333262653533__p5-1.jpg" imgfield="img" /><meta itemprop="image" content="images/tild3538-6431-4262-b839-333262653533__p5-1.jpg"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec209933912" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">CSV файл содержит дату «2/3/2015». Мы сказали Power Query, что дата в источнике в формате, используемом в России, после чего дата была выведена в соответствии с настройками для России. Данный пример не очень показателен, если дата будет «2/15/2015», то без ошибок её можно будет вывести путем установки локали на США. <br /><br /> Используя эту технику, установим для столбца Sales тип данных Десятичное число и Языковые стандарты Великобритании:<br /></div></div></div></div></div></div><div id="rec209934441" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild6131-3666-4533-a431-363531613238__-__empty__p6-1.jpg" data-original="images/tild6131-3666-4533-a431-363531613238__p6-1.jpg" imgfield="img" /><meta itemprop="image" content="images/tild6131-3666-4533-a431-363531613238__p6-1.jpg"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec209930629" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">В результате запятая будет воспринята как разделитель тысяч:</div></div></div></div></div></div><div id="rec209934640" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3161-6237-4365-a130-336334373734__-__empty__p7-1.jpg" data-original="images/tild3161-6237-4365-a130-336334373734__p7-1.jpg" imgfield="img" /><meta itemprop="image" content="images/tild3161-6237-4365-a130-336334373734__p7-1.jpg"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec209930631" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Код этого запроса:</div></div></div></div></div></div><div id="rec209934841" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-animationappear="off" data-record-type="285" ><!-- t264 --><div class="t264"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t264__wrapper t-text t-text_xs" style="border: 0px solid #f8f8f8;"><pre><code class="auto">let  
Источник = Csv.Document(File.Contents(  
&quot;D:\Temp\Перевод\Working With International Date And Number Formats In Power Query\TESTFILE.csv&quot;),  
[Delimiter=&quot; &quot;, Columns=2, Encoding=1251, QuoteStyle=QuoteStyle.None]),
# &quot;Повышенные заголовки&quot; = Table.PromoteHeaders(Источник),
# &quot;Измененный тип&quot; = Table.TransformColumnTypes(  
      #&quot;Повышенные заголовки&quot;,{{&quot;Date&quot;, type date}, {&quot;Sales&quot;, type number}}),
# &quot;Измененный тип с языком&quot; = Table.TransformColumnTypes(  
      #&quot;Измененный тип&quot;, {{&quot;Date&quot;, type date}}, &quot;ru-RU&quot;),
# &quot;Измененный тип с языком1&quot; = Table.TransformColumnTypes(  
      #&quot;Измененный тип с языком&quot;, {{&quot;Sales&quot;, type number}}, &quot;en-GB&quot;)
in
# &quot;Измененный тип с языком1&quot;</code></pre> </div> </div> </div></div> <script type="text/javascript"> $(document).ready(function(){	hljs.initHighlightingOnLoad(); }); </script> <style type="text/css"> .t264 .hljs { background-color: ; }</style> </div><div id="rec209930633" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Вернемся к русским настройкам для обоих столбцов:</div></div></div></div></div></div><div id="rec209930634" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3130-6433-4462-b266-313161366439__-__empty__p8-1.jpg" data-original="images/tild3130-6433-4462-b266-313161366439__p8-1.jpg" imgfield="img" /><meta itemprop="image" content="images/tild3130-6433-4462-b266-313161366439__p8-1.jpg"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec209930635" class="r t-rec t-rec_pt_0 t-rec_pb_120" style="padding-top:0px;padding-bottom:120px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Теперь запятая интерпретируется как разделитель целой и дробной части.<br /></div></div></div></div></div></div></div><!--/allrecords-->