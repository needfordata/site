<!--allrecords--><div id="allrecords" data-tilda-export="yes" class="t-records" data-hook="blocks-collection-content-node" data-tilda-project-id="14542" data-tilda-page-id="12632523" data-tilda-page-alias="blog/text-betweendelimiters" data-tilda-formskey="2bb761110255242a2bbb1bf3f837b680" data-tilda-lazy="yes" data-tilda-project-headcode="yes"><!--header--><div id="t-header" class="t-records" data-hook="blocks-collection-content-node" data-tilda-project-id="14542" data-tilda-page-id="61936" data-tilda-page-alias="header" data-tilda-formskey="2bb761110255242a2bbb1bf3f837b680" data-tilda-project-headcode="yes"></div><!--/header--><div id="rec210737713" class="r t-rec" style=" " data-animationappear="off" data-record-type="891" ><!-- cover --><div class="t-cover" id="recorddiv210737713" bgimgfield="img" style="height:450px; background-image:-webkit-linear-gradient(top, #ccc, #777); background-image:-moz-linear-gradient(top, #ccc, #777); background-image:-o-linear-gradient(top, #ccc, #777); background-image:-ms-linear-gradient(top, #ccc, #777); background-image:linear-gradient(top, #ccc, #777); " ><div class="t-cover__carrier" id="coverCarry210737713" data-content-cover-id="210737713" data-content-cover-bg="" data-content-cover-height="450px" data-content-cover-parallax="" style="height:450px;background-attachment:scroll; "></div> <div class="t-cover__filter" style="height:450px;background-image: -moz-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -webkit-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -o-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: -ms-linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));background-image: linear-gradient(top, rgba(14,31,47,1), rgba(24,45,66,1));filter: progid:DXImageTransform.Microsoft.gradient(startColorStr='#000e1f2f', endColorstr='#00182d42');"></div><div class="t891"> <div class="t-container"> <div class="t-col t-col_12"> <div class="t-cover__wrapper t-valign_middle" style="height:450px;"> <div class="t891__wrapper" data-hook-content="covercontent"> <div class="t891__title t-title t-title_xl" style="padding-top:100px;text-shadow: 0px 2px 5px rgba(0, 0, 0, 0.0);" field="title"><div style="font-size:46px;text-align:left;" data-customstyle="yes">Применение функции Text.BetweenDelimiters()<br /> в коде Power BI/Power Query для извлечения<br /> адреса URL на веб-странице<br /></div></div> <div class="t891__descr t-descr t-descr_xl " style="" field="descr"><div style="font-size:18px;text-align:left;" data-customstyle="yes">Текст представляет собой адаптированный перевод статьи Chris Webb (Крис Уэбб),<br /> оригинал – <a href="https://blog.crossjoin.co.uk/2017/04/25/using-text-betweendelimiters-to-extract-urls-from-a-web-page-in-power-bipower-query-m/">Using Text.BetweenDelimiters() To Extract URLs From A Web Page In Power BI/Power Query M</a></div></div> <span class="space"></span> </div> </div> </div> </div></div> </div> </div><div id="rec210737714" class="r t-rec t-rec_pt_90 t-rec_pb_15" style="padding-top:90px;padding-bottom:15px; " data-record-type="296" ><!-- t265 --><div class="t265"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t265__wrapper" style="background:#fafafa;"> <div class="t265__icon"> <svg x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;"> <circle style="fill:#edbd11;" cx="12.125" cy="12.125" r="12"/> <g> <path style="fill:#ffffff;" d="M10.922,6.486c0-0.728,0.406-1.091,1.217-1.091s1.215,0.363,1.215,1.091c0,0.347-0.102,0.617-0.304,0.81 c-0.202,0.193-0.507,0.289-0.911,0.289C11.328,7.585,10.922,7.219,10.922,6.486z M13.252,17.792h-2.234V9.604h2.234V17.792z"/> </g> </svg> </div> <div class="t265__text t-descr t-descr_xs" style="color:#000000;" field="text"><div style="font-size:14px;" data-customstyle="yes"><a href="https://blog.crossjoin.co.uk/" style="color:rgb(0, 0, 0) !important;">Крис Вебб</a> (Chris Webb) — независимый эксперт, консультант по технологиям Analysis Services, MDX, Power Pivot, DAX, Power Query и Power BI. Его блог — это кладезь информации на тему перечисленных технологий. Вот уже более 10 лет он пишет про BI-решения от Microsoft. Количество его статей перевалило за 1000! Также Крис выступает на большом количестве различных конференций вроде SQLBits, PASS Summit, PASS BA Conference, SQL Saturdays и участвует в различных сообществах.<br />Крис любезно разрешил нам переводить его статьи на русский язык. И это одна из них.</div></div> </div> </div> </div></div></div><div id="rec210737717" class="r t-rec t-rec_pt_15 t-rec_pb_0" style="padding-top:15px;padding-bottom:0px; " data-record-type="128" ><!-- T120 --><div class="t120"> <div class="t-container t-align_left"> <div class="t-col t-col_8 t-prefix_2"> <h3 class="t120__title t-heading t-heading_sm" field="title" style="font-size:16px;">Применение функции Text.BetweenDelimiters() в коде Power BI/Power Query для извлечения адреса URL на веб странице</h3> </div> </div></div></div><div id="rec210737718" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">В апреле 2017 вышел очередной релиз Power BI Desktop в котором добавился функционал <a href="https://powerbi.microsoft.com/en-us/blog/power-bi-desktop-april-feature-summary/#queryEditing">Add Column By Example</a>. Тестируя его несколько недель, мы заметили, что для его работы были добавлены три новых функции: <br /><br /> <a href="https://docs.microsoft.com/ru-ru/powerquery-m/text-betweendelimiters">Text.BetweenDelimiters()</a> – принимает текст и извлекает часть, находящуюся между указанными разделителям.<br /><a href="https://docs.microsoft.com/ru-ru/powerquery-m/text-beforedelimiter">Text.BeforeDelimiter()</a> – принимает текст и возвращает часть, стоящую до указанного разделителя.<br /><a href="https://docs.microsoft.com/ru-ru/powerquery-m/text-afterdelimiter">Text.AfterDelimiter()</a> – принимает текст и возвращает часть, стоящую после разделителя.<br />Сами функции вполне понятны. К тому же в онлайн документации имеются хорошие примеры их использования. Возьмем, для примера, следующий код:<br /></div></div></div></div></div></div><div id="rec210737719" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-animationappear="off" data-record-type="285" ><!-- t264 --><div class="t264"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t264__wrapper t-text t-text_xs" style="border: 0px solid #f8f8f8;"><pre><code class="auto">Text.BetweenDelimiters(&quot;Hello *world!??&quot;, &quot;*&quot;, &quot;!&quot;)</code></pre> </div> </div> </div></div> <script type="text/javascript"> $(document).ready(function(){	hljs.initHighlightingOnLoad(); }); </script> <style type="text/css"> .t264 .hljs { background-color: ; }</style> </div><div id="rec210737720" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">…он вернет текст "world":</div></div></div></div></div></div><div id="rec210737721" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild3030-6531-4161-b265-376539393434__-__empty__image_thumb9.png" data-original="images/tild3030-6531-4161-b265-376539393434__image_thumb9.png" imgfield="img" /><meta itemprop="image" content="images/tild3030-6531-4161-b265-376539393434__image_thumb9.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210737722" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Недавно был задан вопрос: "Можно ли с помощью языка М извлечь все ссылки из атрибутов href в коде веб-страницы. Используя функцию Text.BetweenDelimiters(), это сделать несложно. Для этого напишем следующую функцию:</div></div></div></div></div></div><div id="rec210737723" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-animationappear="off" data-record-type="285" ><!-- t264 --><div class="t264"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t264__wrapper t-text t-text_xs" style="border: 0px solid #f8f8f8;"><pre><code class="auto">(SourceURL as text, AttributeDelimiter as text) =&gt;
let
    //Get HTML source
    Source = Text.FromBinary(Web.Contents(SourceURL)),
    //Function to find each link
    GetLink = (Counter as number) =&gt;
                    let
                        CurrentLink = 
        Text.BetweenDelimiters(
            Source, 
            &quot;href=&quot; &amp; AttributeDelimiter, 
            AttributeDelimiter,
            Counter
        )
                    in
                        if CurrentLink=&quot;&quot; 
        then 
            {} 
        else 
            List.Combine({
                {CurrentLink}, 
                @GetLink(Counter+1)}
            ),
    //Call function
    Output = GetLink(0)
in
    Output</code></pre> </div> </div> </div></div> <script type="text/javascript"> $(document).ready(function(){	hljs.initHighlightingOnLoad(); }); </script> <style type="text/css"> .t264 .hljs { background-color: ; }</style> </div><div id="rec210737724" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Отметим несколько вещей: <br /><br /> <ul> <li> Здесь используется комбинация функций Text.FromBinary() и Web.Contents() для получения HTML кода страницы, с которой мы извлекаем ссылки. </li> <li> Так как HTML позволяет применять для атрибутов как одинарные, так и двойные кавычки, был добавлен параметр AttributeDelimiter, определяющий, какие именно использованы. </li> <li> Функция Text.BetweenDelimiters извлекает за один раз только один участок текста. Но можно указать, какое вхождение разделителей обрабатывать. В данном коде применяется рекурсия для извлечения содержимого каждого атрибута href в коде HTML. Объявляется функция GetLink, из которой происходит рекурсивный вызов. Для этого ставим знак @ перед именем функции. Возможно, здесь лучше использовать функцию List.Generate(). </li> </ul> Назовём этот запрос GetAllLinks<br /></div></div></div></div></div></div><div id="rec210737725" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild6461-6239-4237-b730-313364333562__-__empty__image_thumb10.png" data-original="images/tild6461-6239-4237-b730-313364333562__image_thumb10.png" imgfield="img" /><meta itemprop="image" content="images/tild6461-6239-4237-b730-313364333562__image_thumb10.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210737726" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">…его можно использовать в другом запросе:</div></div></div></div></div></div><div id="rec210738611" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-animationappear="off" data-record-type="285" ><!-- t264 --><div class="t264"> <div class="t-container"> <div class="t-col t-col_8 t-prefix_2"> <div class="t264__wrapper t-text t-text_xs" style="border: 0px solid #f8f8f8;"><pre><code class="auto">GetAllLinks(
    &quot;https://msdn.microsoft.com/en-us/library/mt798303.aspx&quot;, 
    &quot;&quot;&quot;&quot;
)</code></pre> </div> </div> </div></div> <script type="text/javascript"> $(document).ready(function(){	hljs.initHighlightingOnLoad(); }); </script> <style type="text/css"> .t264 .hljs { background-color: ; }</style> </div><div id="rec210738699" class="r t-rec t-rec_pt_0 t-rec_pb_0" style="padding-top:0px;padding-bottom:0px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Отметим один момент. Чтобы передать функции двойные кавычки как текст, их нужно заключить в двойные кавычки, получится четыре кавычки подряд: """" <br /><br /> На выходе получим список всех ссылок страницы из атрибутов href, заключенных в двойные кавычки:<br /></div></div></div></div></div></div><div id="rec210737727" class="r t-rec t-rec_pt_15 t-rec_pb_15" style="padding-top:15px;padding-bottom:15px; " data-record-type="224" ><!-- T196 --><div class="t196"> <div class="t-container" itemscope itemtype="http://schema.org/ImageObject"> <div class="t-col t-col_8 t-prefix_2 t-align_center"> <img class="t196__img t-img" src="images/tild6330-3331-4864-b039-323262326332__-__empty__image_thumb11.png" data-original="images/tild6330-3331-4864-b039-323262326332__image_thumb11.png" imgfield="img" /><meta itemprop="image" content="images/tild6330-3331-4864-b039-323262326332__image_thumb11.png"> </div> <div class="t-col t-col_2 "> <div class="t196__descr t-descr t-descr_xs" style="" field="title" itemprop="name"></div> </div> </div></div></div><div id="rec210737742" class="r t-rec t-rec_pt_0 t-rec_pb_120" style="padding-top:0px;padding-bottom:120px; " data-record-type="106" ><!-- T004 --><div class="t004"><div class="t-container "> <div class="t-col t-col_8 t-prefix_2"><div field="text" class="t-text t-text_md " style=""><div style="font-size:14px;" data-customstyle="yes">Нашу функцию можно улучшить, чтобы она обходила несколько страниц и собирала ссылки с них, а потом использовать инструмент в Excel <em>Force Directed Graph</em> или даже NodeXL для визуализации связей страничек между собой. Но это мы оставим вам.</div></div></div></div></div></div></div><!--/allrecords-->